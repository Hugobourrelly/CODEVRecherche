# -*- coding: utf-8 -*-
"""
Created on Wed May 24 08:22:46 2023

@author: hugob
"""

import pandas as pd
import numpy as np
from os import listdir


def indicepluspetitquex(L,x):
    """Donne le plus grand indice n de L dont L[n]<x"""
    n=0
    taille=len(L)
    while n<taille-1 and L[n+1]<x:
        n+=1
    return n
    
        

def extraction_data_set(chemin_data_set,chemin_étalon):
    def couranttofield(I):
        """Couvertit le courant en champ par un DL ordre 1"""
        étalon=pd.read_csv(chemin_étalon,sep=' ',skiprows=2,engine='python')
        coura=list(étalon[((étalon.columns)[0])])[::-1]
        champ=list(étalon[((étalon.columns)[1])])[::-1]
        ind=indicepluspetitquex(coura,I)
        if ind>=len(champ):
            raise "Erreur"
        return champ[ind]+(I-coura[ind])*(champ[ind]-champ[ind-1])/(coura[ind]-coura[ind-1])
    listfichier=listdir(chemin_data_set)
    listfichier=listfichier[3:-1]
    H=[]
    FreqL=[]
    Im=[]
    Re=[]
    Courant=[]
    n=0
    for i in listfichier:
        n+=1
        courant=float((i.split("=")[1]).split("A")[0])
        a=pd.read_csv(chemin_data_set+r'\\'+i,sep='	',skiprows=1)
        ImL12=list(a["Im(DeltaL12)"])
        ReL12=list(a["Re(DeltaL12)"])
        Freq=list(a['# Freq(GHz) '])
        Courant.append(courant)
        H.append(round(couranttofield(courant), 6))
        FreqL.append(Freq)
        Re.append(ReL12)
        Im.append(ImL12)
    Im1=np.array(Im)
    FreqL1=np.array(FreqL[0])
    Re1=np.array(Re)
    return H,Im1,Re1,FreqL1
